---
import Counter from '../components/Counter.tsx'
import BaseLayout from '../layouts/BaseLayout.astro'
---

<BaseLayout title="Astro Accepts React and Tailwind!">
  <main class="border">
    <h1 class="text-2xl font-bold">Hello Astro Islands v4</h1></div>
    <div><a href="/layout01" class="">/layout01</a></div>
    <div><a href="/layout02" class="">/layout02</a></div>
    <br></br>
    <Counter client:visible />
      <button id="btn-hello" class="rounded border px-3 py-2">/api/hello</button>
      <button id="btn-me" class="rounded border px-3 py-2">/api/me</button>

    <pre id="out" class="rounded bg-white p-3 text-sm shadow"></pre>

    <script>
      import { baseAddress } from "../config"

      const out = document.getElementById('out')
      const show = (title: string, data: unknown) => out!.textContent = `${title}\n` + JSON.stringify(data, null, 2)

      document.getElementById('btn-hello')?.addEventListener('click', async () => {
        console.log(`call ${baseAddress}/api/hello`); 
        const r = await fetch(`${baseAddress}/api/hello`, { headers: { Accept: 'application/json' } })
        show('[GET] /api/hello', await r.json())
      })
      document.getElementById('btn-me')?.addEventListener('click', async () => {
        console.log(`call ${baseAddress}/api/me`); 
        const r = await fetch(`${baseAddress}/api/me`, { credentials: 'include' })
        let body; try { body = await r.json() } catch { body = { error: true } }
        show(`[GET] /api/me (${r.status})`, body)
      })
    </script>
  </main>
</BaseLayout>

